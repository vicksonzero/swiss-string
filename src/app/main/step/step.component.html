<div class="card" [class.isOrganizeMode]="isOrganizeMode">
  <div class="card-body">
    <h5 class="card-title">
      <button class="expand-button btn btn-secondary btn-sm" (click)="onExpandButtonClick()">
        <fa-icon *ngIf="isExpanded" [icon]="faMinus"></fa-icon>
        <fa-icon *ngIf="!isExpanded" [icon]="faPlus"></fa-icon>
      </button>
      <span class="text-secondary">{{itemIndex}}.{{ ' ' }}</span>
      <app-editable-wrapper [value]="step.title" (valueChange)="onTitleUpdated($event)"></app-editable-wrapper>{{ ' ' }}
      <span>[{{step.stepID}}]</span>
      <span style="display:inline-block;width:4px;"></span>
      <span class="text-secondary step-type">{{step.description}}</span>
    </h5>
  </div>
  <div class="card-body step-body" [class.isMobile]="isMobile" [hidden]="!isExpanded">
    <app-transition-group
      class="flip-list" [class.isMobile]="isMobile" [className]="'flip-list'"
      [appMatchHeight]="isMobile ? '' : ('step-'+step.stepID+'-input-items step-'+step.stepID+'-output-items')">

      <app-column class="column list-items" [class.isMobile]="isMobile"
        *ngFor="let column of columns; let i = index; trackBy: trackColumn" [index]="i"
        [style.flex]="isMobile ? '' : (column.width)" [style.minHeight]="column.height + 'px'"

        appTransitionGroupItem
        [stepID]="step.stepID" [nodeInstance]="nodes[column.nodeID]"
        [isOrganizeMode]="isOrganizeMode"
        [canSizeUp]="true" [canSizeDown]="column.height>100"
        [canArrangeUp]="i>0" [canArrangeDown]="i < columns.length-1"
        [canArrangeUpStep]="i <= 0 && canArrangeUp" [canArrangeDownStep]="i >= columns.length-1 && canArrangeDown"

        (clickResizeButton)="onClickColumnChangeSize(column.nodeID, $event)"
        (clickArrangeButton)="onClickColumnArrange(column.nodeID, $event)"
        (clickArrangeToStepButton)="onClickColumnArrangeToStep(column.nodeID, $event)"
        (requestMoveToStep)="onColumnMoveToStep(column.nodeID, $event)"
        (clickTrash)="onClickColumnRemove(column.nodeID)">
      </app-column>
    </app-transition-group>
  </div>

  <div class="step-buttons card-body toolbar" [hidden]="!isExpanded">
    <div class="toolbar-default" *ngIf="!isOrganizeMode">
      <button class="btn btn-light" (click)="onClickAddNode()">Add Node</button>{{ ' ' }}
      <button class="btn btn-light" (click)="onClickOrganize()">Organize</button>{{ ' ' }}
      <div class="btn-group" role="group" aria-label="Basic example">
        <button class="btn btn-light" [disabled]="!canArrangeUp" (click)="onClickStepArrange(-1)" title="Move Step Up">
          <fa-icon [icon]="faArrowUp"></fa-icon>
        </button>
        <button class="btn btn-light" [disabled]="!canArrangeDown" (click)="onClickStepArrange(+1)"
          title="Move Step Down">
          <fa-icon [icon]="faArrowDown"></fa-icon>
        </button>
      </div>{{ ' ' }}
      <button class="btn btn-light" (click)="onClickRemoveStep()">Remove Step</button>
    </div>
    <div class="toolbar-organize" *ngIf="isOrganizeMode">
      <button class="btn btn-light" (click)="onClickEndOrganize()">End Organize</button>{{ ' ' }}
    </div>
  </div>
</div>
